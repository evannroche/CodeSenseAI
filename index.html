<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Code Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            min-height: 600px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .tab-container {
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab {
            background: none;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 1rem;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .file-upload {
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 15px;
            color: #94a3b8;
        }

        .upload-text {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        #fileInput {
            display: none;
        }

        .code-input {
            width: 100%;
            height: 300px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            width: 100%;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:active {
            transform: translateY(0);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .summary-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .summary-card p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .file-results {
            margin-bottom: 30px;
        }

        .file-header {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .file-header h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .file-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .issues-container {
            margin-top: 20px;
        }

        .issue-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .issue-item.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .issue-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .issue-item.info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }

        .issue-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }

        .issue-type {
            font-weight: 600;
            text-transform: capitalize;
        }

        .issue-line {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: auto;
        }

        .issue-message {
            color: #374151;
            margin-bottom: 8px;
        }

        .issue-suggestion {
            font-size: 0.9rem;
            color: #6b7280;
            font-style: italic;
        }

        .functions-classes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .function-class-list {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
        }

        .function-class-list h4 {
            color: #374151;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .item {
            padding: 8px 12px;
            background: white;
            margin-bottom: 8px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .no-results .icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            opacity: 0.5;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #dc2626;
        }

        .error-message h4 {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .functions-classes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🐍 Python Code Analyzer</h1>
            <p>Analyze your Python code for quality, complexity, and potential issues</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    Input Code
                </h2>
                
                <div class="tab-container">
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('upload')">📁 Upload Files</button>
                        <button class="tab" onclick="switchTab('paste')">📝 Paste Code</button>
                    </div>
                    
                    <div id="upload-tab" class="tab-content active">
                        <div class="file-upload" id="fileUpload">
                            <svg class="upload-icon" viewBox="0 0 24 24">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            <p class="upload-text">Drop Python files here or click to browse</p>
                            <p class="upload-subtext">Supports .py files up to 16MB</p>
                        </div>
                        <input type="file" id="fileInput" multiple accept=".py">
                        <div id="fileList"></div>
                    </div>
                    
                    <div id="paste-tab" class="tab-content">
                        <textarea 
                            class="code-input" 
                            id="codeInput" 
                            placeholder="Paste your Python code here...

Example:
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

class Calculator:
    def add(self, a, b):
        return a + b
"></textarea>
                        <input type="text" id="filename" placeholder="Filename (optional)" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 5px; margin-top: 10px;">
                    </div>
                </div>
                
                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeCode()">
                    🔍 Analyze Code
                </button>
            </div>

            <div class="results-section">
                <h2 class="section-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,5 21,3.89 19,3M19,5V19H5V5H19Z"/>
                    </svg>
                    Analysis Results
                </h2>
                
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing your code...</p>
                </div>
                
                <div id="results" class="no-results">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                    </svg>
                    <h3>No Analysis Yet</h3>
                    <p>Upload Python files or paste code to see detailed analysis results</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFiles = [];
        let currentAnalysis = null;

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // File upload handling
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');

        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', handleDragOver);
        fileUpload.addEventListener('dragleave', handleDragLeave);
        fileUpload.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => file.name.endsWith('.py'));
            selectedFiles = files;
            updateFileList();
        }

        function handleFileSelect(e) {
            selectedFiles = Array.from(e.target.files);
            updateFileList();
        }

        function updateFileList() {
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }

            fileList.innerHTML = `
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: #374151;">Selected Files (${selectedFiles.length}):</h4>
                    ${selectedFiles.map(file => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f8fafc; border-radius: 6px; margin-bottom: 5px;">
                            <span style="font-family: monospace; font-size: 0.9rem;">${file.name}</span>
                            <span style="color: #64748b; font-size: 0.8rem;">${(file.size / 1024).toFixed(1)} KB</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Analysis function
        async function analyzeCode() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            // Determine which input method is active
            const activeTab = document.querySelector('.tab.active').textContent.includes('Upload') ? 'upload' : 'paste';
            
            if (activeTab === 'upload' && selectedFiles.length === 0) {
                alert('Please select Python files to analyze');
                return;
            }
            
            if (activeTab === 'paste' && !document.getElementById('codeInput').value.trim()) {
                alert('Please paste some Python code to analyze');
                return;
            }

            // Show loading state
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = '🔄 Analyzing...';
            loading.style.display = 'block';
            results.innerHTML = '';

            try {
                let response;
                
                if (activeTab === 'upload') {
                    // Upload files
                    const formData = new FormData();
                    selectedFiles.forEach(file => formData.append('files', file));
                    
                    response = await fetch('/api/analyze', {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    // Send text
                    const code = document.getElementById('codeInput').value;
                    const filename = document.getElementById('filename').value || 'pasted_code.py';
                    
                    response = await fetch('/api/analyze-text', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ code, filename })
                    });
                }

                const data = await response.json();
                
                if (data.success) {
                    currentAnalysis = data;
                    displayResults(data);
                } else {
                    displayError(data.error || 'Analysis failed');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                displayError('Failed to connect to analysis server');
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = '🔍 Analyze Code';
                loading.style.display = 'none';
            }
        }

        function displayResults(data) {
            const results = document.getElementById('results');
            
            results.innerHTML = `
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>${data.summary.total_files}</h3>
                        <p>Files Analyzed</p>
                    </div>
                    <div class="summary-card">
                        <h3>${data.summary.total_lines}</h3>
                        <p>Lines of Code</p>
                    </div>
                    <div class="summary-card">
                        <h3>${data.summary.total_issues}</h3>
                        <p>Issues Found</p>
                    </div>
                    <div class="summary-card">
                        <h3>${data.summary.average_complexity}</h3>
                        <p>Avg Complexity</p>
                    </div>
                </div>
                
                ${data.files.map(file => generateFileResults(file)).join('')}
            `;
        }

        function generateFileResults(file) {
            const stats = file.statistics;
            const hasError = file.error;
            
            if (hasError) {
                return `
                    <div class="file-results">
                        <div class="file-header">
                            <h3>📄 ${file.file_path}</h3>
                            <div class="error-message">
                                <h4>Analysis Error</h4>
                                <p>${file.error}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="file-results">
                    <div class="file-header">
                        <h3>📄 ${file.file_path}</h3>
                        <div class="file-stats">
                            <div class="stat-item">
                                <div class="stat-value">${stats.total_lines}</div>
                                <div class="stat-label">Total Lines</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${stats.code_lines}</div>
                                <div class="stat-label">Code Lines</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${stats.function_count}</div>
                                <div class="stat-label">Functions</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${stats.class_count}</div>
                                <div class="stat-label">Classes</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${stats.complexity_score}</div>
                                <div class="stat-label">Complexity</div>
                            </div>
                        </div>
                    </div>

                    ${generateIssuesSection(file.issues)}
                    ${generateFunctionsClassesSection(file.functions, file.classes)}
                </div>
            `;
        }

        function generateIssuesSection(issues) {
            if (!issues || issues.length === 0) {
                return `
                    <div class="issues-container">
                        <h4 style="color: #059669; margin-bottom: 15px;">✅ No Issues Found</h4>
                        <p style="color: #6b7280;">This file looks good! No potential issues detected.</p>
                    </div>
                `;
            }

            const severityCounts = issues.reduce((acc, issue) => {
                acc[issue.severity] = (acc[issue.severity] || 0) + 1;
                return acc;
            }, {});

            return `
                <div class="issues-container">
                    <h4 style="color: #374151; margin-bottom: 15px;">
                        ⚠️ Issues Found (${issues.length})
                        ${severityCounts.error ? `<span style="color: #ef4444; margin-left: 10px;">${severityCounts.error} errors</span>` : ''}
                        ${severityCounts.warning ? `<span style="color: #f59e0b; margin-left: 10px;">${severityCounts.warning} warnings</span>` : ''}
                        ${severityCounts.info ? `<span style="color: #3b82f6; margin-left: 10px;">${severityCounts.info} info</span>` : ''}
                    </h4>
                    ${issues.map(issue => `
                        <div class="issue-item ${issue.severity}">
                            <div class="issue-header">
                                <span class="issue-type">${issue.type.replace(/_/g, ' ')}</span>
                                <span class="issue-line">Line ${issue.line}</span>
                            </div>
                            <div class="issue-message">${issue.message}</div>
                            ${issue.suggestion ? `<div class="issue-suggestion">💡 ${issue.suggestion}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateFunctionsClassesSection(functions, classes) {
            return `
                <div class="functions-classes">
                    <div class="function-class-list">
                        <h4>
                            <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12,3L2,12H5V20H19V12H22L12,3M12,7.5L17,12.5V18H7V12.5L12,7.5Z"/>
                            </svg>
                            Functions (${functions.length})
                        </h4>
                        <div class="item-list">
                            ${functions.length > 0 ? functions.map(func => `
                                <div class="item">
                                    <strong>${func.name}</strong>
                                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 4px;">
                                        Lines ${func.line_start}-${func.line_end} • 
                                        ${func.args_count} args • 
                                        Complexity: ${func.complexity}
                                        ${func.has_docstring ? ' • 📖' : ''}
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #64748b; font-style: italic;">No functions found</p>'}
                        </div>
                    </div>
                    
                    <div class="function-class-list">
                        <h4>
                            <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2Z"/>
                            </svg>
                            Classes (${classes.length})
                        </h4>
                        <div class="item-list">
                            ${classes.length > 0 ? classes.map(cls => `
                                <div class="item">
                                    <strong>${cls.name}</strong>
                                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 4px;">
                                        Lines ${cls.line_start}-${cls.line_end} • 
                                        ${cls.method_count} methods
                                        ${cls.has_docstring ? ' • 📖' : ''}
                                        ${cls.inheritance && cls.inheritance.length > 0 ? ` • Inherits: ${cls.inheritance.join(', ')}` : ''}
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #64748b; font-style: italic;">No classes found</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function displayError(message) {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="error-message">
                    <h4>❌ Analysis Error</h4>
                    <p>${message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">
                        Please check that your Python code is valid and the backend server is running.
                    </p>
                </div>
            `;
        }

        // Health check function
        async function checkBackendHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    console.log('✅ Backend is healthy:', data.message);
                    return true;
                }
            } catch (error) {
                console.error('❌ Backend health check failed:', error);
                showBackendError();
                return false;
            }
        }

        function showBackendError() {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="error-message">
                    <h4>🔌 Backend Connection Error</h4>
                    <p>Unable to connect to the Python Code Analyzer backend.</p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">
                        Please ensure the Flask backend is running on port 5000:
                    </p>
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; font-size: 0.9rem;">
                        python app.py
                    </div>
                    <p style="font-size: 0.9rem; color: #6b7280;">
                        The backend should be accessible at <code>http://localhost:5000</code>
                    </p>
                </div>
            `;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter to analyze
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                analyzeCode();
            }
            
            // Ctrl/Cmd + U to switch to upload tab
            if ((e.ctrlKey || e.metaKey) && e.key === 'u') {
                e.preventDefault();
                document.querySelector('.tab').click();
            }
            
            // Ctrl/Cmd + T to switch to text tab
            if ((e.ctrlKey || e.metaKey) && e.key === 't') {
                e.preventDefault();
                document.querySelectorAll('.tab')[1].click();
            }
        });

        // Auto-resize textarea
        const codeInput = document.getElementById('codeInput');
        codeInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.max(300, this.scrollHeight) + 'px';
        });

        // Sample code examples
        const sampleCodes = {
            fibonacci: `def fibonacci(n):
    """Calculate fibonacci number recursively (inefficient)"""
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

def fibonacci_optimized(n):
    """Calculate fibonacci number iteratively"""
    if n <= 1:
        return n
    
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b

# Test the functions
for i in range(10):
    print(f"F({i}) = {fibonacci_optimized(i)}")`,

            calculator: `class Calculator:
    """A simple calculator class with various operations"""
    
    def __init__(self):
        self.history = []
    
    def add(self, a, b):
        result = a + b
        self.history.append(f"{a} + {b} = {result}")
        return result
    
    def subtract(self, a, b):
        result = a - b
        self.history.append(f"{a} - {b} = {result}")
        return result
    
    def multiply(self, a, b):
        result = a * b
        self.history.append(f"{a} * {b} = {result}")
        return result
    
    def divide(self, a, b):
        if b == 0:
            raise ValueError("Cannot divide by zero")
        result = a / b
        self.history.append(f"{a} / {b} = {result}")
        return result
    
    def get_history(self):
        return self.history.copy()
    
    def clear_history(self):
        self.history.clear()

# Usage example
calc = Calculator()
print(calc.add(10, 5))
print(calc.multiply(3, 4))
print(calc.divide(15, 3))`,

            issues: `import os
import pickle

# This code has various issues that will be detected

def problematic_function(a, b, c, d, e, f, g, h, i):  # Too many parameters
    password = "hardcoded_secret_123"  # Security issue
    
    # Bare except clause
    try:
        result = eval(a)  # Dangerous function
    except:
        pass  # Empty except block
    
    # Complex boolean condition
    if a > 0 and b < 10 and c != 0 and d == "test" and e is not None:
        for x in range(100):
            for y in range(100):
                for z in range(100):  # Deep nesting
                    print("Deep loop")  # Print statement
    
    # Multiple returns
    if a > 10:
        return a
    elif b > 10:
        return b
    elif c > 10:
        return c
    else:
        return 0

class GodClass:  # Will have too many methods
    def method1(self): pass
    def method2(self): pass
    def method3(self): pass
    # ... imagine 20+ methods here
    
x = 42  # Magic number
y = 3.14159265359  # Another magic number

# SQL injection vulnerability
def unsafe_query(user_input):
    query = "SELECT * FROM users WHERE name = '" + user_input + "'"
    return query`
        };

        // Add sample code buttons
        function addSampleCodeButtons() {
            const pasteTab = document.getElementById('paste-tab');
            const buttonsHtml = `
                <div style="margin-bottom: 15px;">
                    <p style="margin-bottom: 10px; color: #64748b; font-size: 0.9rem;">Quick examples:</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="loadSampleCode('fibonacci')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">📊 Fibonacci</button>
                        <button onclick="loadSampleCode('calculator')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">🧮 Calculator</button>
                        <button onclick="loadSampleCode('issues')" style="padding: 6px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">⚠️ Issues Demo</button>
                        <button onclick="clearCode()" style="padding: 6px 12px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: #dc2626;">🗑️ Clear</button>
                    </div>
                </div>
            `;
            pasteTab.insertAdjacentHTML('afterbegin', buttonsHtml);
        }

        function loadSampleCode(type) {
            const codeInput = document.getElementById('codeInput');
            const filename = document.getElementById('filename');
            
            codeInput.value = sampleCodes[type];
            filename.value = `${type}_example.py`;
            
            // Trigger resize
            codeInput.style.height = 'auto';
            codeInput.style.height = Math.max(300, codeInput.scrollHeight) + 'px';
        }

        function clearCode() {
            document.getElementById('codeInput').value = '';
            document.getElementById('filename').value = '';
            document.getElementById('codeInput').style.height = '300px';
        }

        // Export functionality
        function exportResults(format) {
            if (!currentAnalysis) {
                alert('No analysis results to export');
                return;
            }

            let content, mimeType, filename;
            
            switch (format) {
                case 'json':
                    content = JSON.stringify(currentAnalysis, null, 2);
                    mimeType = 'application/json';
                    filename = 'code_analysis.json';
                    break;
                case 'txt':
                    content = generateTextReport(currentAnalysis);
                    mimeType = 'text/plain';
                    filename = 'code_analysis.txt';
                    break;
                case 'html':
                    content = generateHtmlReport(currentAnalysis);
                    mimeType = 'text/html';
                    filename = 'code_analysis.html';
                    break;
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generateTextReport(data) {
            let report = `PYTHON CODE ANALYSIS REPORT\n${'='.repeat(50)}\n\n`;
            
            report += `SUMMARY\n${'-'.repeat(20)}\n`;
            report += `Files Analyzed: ${data.summary.total_files}\n`;
            report += `Total Lines: ${data.summary.total_lines}\n`;
            report += `Total Issues: ${data.summary.total_issues}\n`;
            report += `Average Complexity: ${data.summary.average_complexity}\n\n`;

            data.files.forEach(file => {
                report += `FILE: ${file.file_path}\n${'-'.repeat(40)}\n`;
                
                if (file.error) {
                    report += `ERROR: ${file.error}\n\n`;
                    return;
                }

                const stats = file.statistics;
                report += `Lines of Code: ${stats.code_lines}\n`;
                report += `Functions: ${stats.function_count}\n`;
                report += `Classes: ${stats.class_count}\n`;
                report += `Complexity: ${stats.complexity_score}\n\n`;

                if (file.issues && file.issues.length > 0) {
                    report += `ISSUES (${file.issues.length}):\n`;
                    file.issues.forEach(issue => {
                        report += `  [${issue.severity.toUpperCase()}] Line ${issue.line}: ${issue.message}\n`;
                        if (issue.suggestion) {
                            report += `    Suggestion: ${issue.suggestion}\n`;
                        }
                    });
                } else {
                    report += `✓ No issues found\n`;
                }
                report += '\n';
            });

            return report;
        }

        function generateHtmlReport(data) {
            return `<!DOCTYPE html>
<html>
<head>
    <title>Code Analysis Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 40px; }
        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .file { margin-bottom: 30px; border: 1px solid #ddd; border-radius: 8px; }
        .file-header { background: #f1f3f4; padding: 15px; border-radius: 8px 8px 0 0; }
        .file-content { padding: 20px; }
        .issue { padding: 10px; margin: 5px 0; border-left: 4px solid; border-radius: 4px; }
        .issue.error { border-color: #dc3545; background: #f8d7da; }
        .issue.warning { border-color: #ffc107; background: #fff3cd; }
        .issue.info { border-color: #17a2b8; background: #d1ecf1; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0; }
        .stat { text-align: center; padding: 10px; background: #f8f9fa; border-radius: 6px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🐍 Python Code Analysis Report</h1>
        <p>Generated on ${new Date().toLocaleString()}</p>
    </div>
    
    <div class="summary">
        <h2>Summary</h2>
        <div class="stats">
            <div class="stat"><strong>${data.summary.total_files}</strong><br>Files</div>
            <div class="stat"><strong>${data.summary.total_lines}</strong><br>Lines</div>
            <div class="stat"><strong>${data.summary.total_issues}</strong><br>Issues</div>
            <div class="stat"><strong>${data.summary.average_complexity}</strong><br>Avg Complexity</div>
        </div>
    </div>
    
    ${data.files.map(file => `
        <div class="file">
            <div class="file-header">
                <h3>📄 ${file.file_path}</h3>
            </div>
            <div class="file-content">
                ${file.error ? `<div class="issue error"><strong>Error:</strong> ${file.error}</div>` : `
                    <div class="stats">
                        <div class="stat"><strong>${file.statistics.code_lines}</strong><br>Code Lines</div>
                        <div class="stat"><strong>${file.statistics.function_count}</strong><br>Functions</div>
                        <div class="stat"><strong>${file.statistics.class_count}</strong><br>Classes</div>
                        <div class="stat"><strong>${file.statistics.complexity_score}</strong><br>Complexity</div>
                    </div>
                    
                    <h4>Issues (${file.issues.length})</h4>
                    ${file.issues.length > 0 ? file.issues.map(issue => `
                        <div class="issue ${issue.severity}">
                            <strong>Line ${issue.line}:</strong> ${issue.message}
                            ${issue.suggestion ? `<br><em>💡 ${issue.suggestion}</em>` : ''}
                        </div>
                    `).join('') : '<p>✅ No issues found</p>'}
                `}
            </div>
        </div>
    `).join('')}
</body>
</html>`;
        }

        // Add export buttons to results
        function addExportButtons() {
            if (!currentAnalysis) return;
            
            const results = document.getElementById('results');
            const exportButtons = document.createElement('div');
            exportButtons.style.cssText = 'margin-top: 20px; padding: 20px; background: #f8fafc; border-radius: 10px; text-align: center;';
            exportButtons.innerHTML = `
                <h4 style="margin-bottom: 15px; color: #374151;">📥 Export Results</h4>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="exportResults('json')" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">📋 JSON</button>
                    <button onclick="exportResults('txt')" style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 6px; cursor: pointer;">📄 Text</button>
                    <button onclick="exportResults('html')" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer;">🌐 HTML</button>
                </div>
            `;
            results.appendChild(exportButtons);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            addSampleCodeButtons();
            checkBackendHealth();
            
            // Add help tooltip
            const helpTooltip = document.createElement('div');
            helpTooltip.innerHTML = `
                <div style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 10px; font-size: 0.9rem; max-width: 300px; z-index: 1000;">
                    <strong>💡 Keyboard Shortcuts:</strong><br>
                    • Ctrl/Cmd + Enter: Analyze code<br>
                    • Ctrl/Cmd + U: Upload tab<br>
                    • Ctrl/Cmd + T: Text tab<br>
                    <button onclick="this.parentElement.parentElement.style.display='none'" style="background: none; border: none; color: white; float: right; cursor: pointer; margin-top: -10px;">✕</button>
                </div>
            `;
            
            // Show help tooltip for 5 seconds
            document.body.appendChild(helpTooltip);
            setTimeout(() => {
                if (helpTooltip.parentElement) {
                    helpTooltip.style.display = 'none';
                }
            }, 8000);
        });

        // Override displayResults to add export buttons
        const originalDisplayResults = displayResults;
        displayResults = function(data) {
            originalDisplayResults(data);
            setTimeout(addExportButtons, 100); // Add after DOM update
        };
    </script>
</body>
</html>